@{
    ViewBag.Title = "Crédito Comunal Nuevo";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<!-- Content Wrapper. Contains page content -->

<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <h1>
            Crédito Comunal Nuevo
        </h1>
        <ol class="breadcrumb">
            <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
            <li><a href="#">Crédito</a></li>
            <li class="active">Crédito Comunal Nuevo</li>
        </ol>
    </section>
    <!-- Main content -->
    <section class="content">
        <div class="row">
            <!-- left column -->
            <div class="col-md-12">
                <!-- general form elements -->
                <div class="box box-primary">
                    <div class="box-header with-border">
                        <h2 class="box-title">Crédito Comunal Nuevo</h2>
                    </div>
                    <!-- /.box-header -->
                    <div class="box-body">
                        <div class="row">
                            <div class="col-xs-3 col-md-3">
                                <label>Documento:</label>
                                <select class="form-control select2" id="tipo_check">
                                    <option selectd value="0">Selecciona</option>
                                </select>
                            </div>
                            <div class="col-xs-3 col-md-3">
                                <label>Sucursal:</label>
                                <select class="form-control select2" id="sucursal">
                                    <option selectd value="0">Selecciona</option>
                                    <option value="1">Independencia</option>
                                    <option value="2">Hidalgo</option>
                                </select>
                            </div>
                            <div class="col-xs-3 col-md-3">
                                <label>Grupo:</label>
                                <select class="form-control select2" id="grupoCom">
                                    <option selectd value="0">Selecciona</option>
                                    <option value="1">Yaneli Hernandez</option>
                                    <option value="2">Margarita Reyes</option>
                                    <option value="3">Gilberto Rodriguez</option>
                                </select>
                            </div>
                            <div class="col-xs-3 col-md-3">
                                <label>Fecha de Solicitud:</label>
                                <input type="text" class="form-control pull-right fca" id="fecha_solicitud">
                            </div>
                        </div>
                        <div class="row mt-5">
                            <div class="col-xs-3 col-md-3">
                                <label>Fecha de Desembolso:</label>
                                <input type="text" class="form-control pull-right fca" id="fecha_desembolso">
                            </div>
                            <div class="col-xs-3 col-md-3">
                                <label>Código de grupo</label>
                                <input type="text" class="form-control" id="codigo_grupo" style="text-transform:uppercase" maxlength="20" />
                            </div>
                            <div class="col-xs-3 col-md-3">
                                <label>Secuencia:</label>
                                <input type="text" class="form-control" id="secuencia" maxlength="4" />
                            </div>
                            <div class="col-xs-3 col-md-3">
                                <label>Tipo de crédito:</label>
                                <select class="form-control select2" id="tipo_credito">
                                    <option selectd value="0">Selecciona</option>
                                    <option value="1">Base</option>
                                    <option value="2">Ampliación</option>
                                    <option value="3">Renovación</option>
                                    <option value="4">Reestructura</option>
                                </select>
                            </div>
                        </div>
                        <div class="row mt-5">
                            <div class="col-xs-3 col-md-3">
                                <label>Monto:</label>
                                <input type="text" class="form-control" id="monto" />
                            </div>
                            <div class="col-xs-3 col-md-3">
                                <label>Tasa</label>
                                <input type="text" class="form-control" id="tasa" maxlength="2" onkeypress="return isNumberKey(event)" />
                            </div>
                            <div class="col-xs-3 col-md-3">
                                <label>Cuotas</label>
                                <input type="text" class="form-control" id="cuotas" maxlength="4" onkeypress="return isNumberKey(event)" />
                            </div>
                            <div class="col-xs-3 col-md-3">
                                <label>Fondo C:</label>
                                <input type="text" class="form-control" id="fondo_c" />
                            </div>
                        </div>
                        <hr />
                        <div class="row mt-5">
                            <div class="col-xs-3 col-md-3">
                                <label>Frecuencia de Pago</label>
                                <select class="form-control select2" id="frecuencia_pago">
                                    <option selectd value="0">Selecciona</option>
                                    <option value="1">Semanal</option>
                                    <option value="2">Catorcenal</option>
                                </select>
                            </div>
                            <div class="col-xs-3 col-md-3">
                                <label>Tipo de desembolso</label>
                                <select class="form-control select2" id="tipo_desembolso">
                                    <option selectd value="0">Selecciona</option>
                                    <option value="1">Cheque</option>
                                    <option value="2">Efectivo/Orden de Pago</option>
                                </select>
                            </div>
                            <div class="col-xs-3 col-md-3">
                                <label>Día de Pago</label>
                                <input type="text" class="form-control" id="dia_pago" maxlength="2" onblur="compruebaV()" onkeypress="return isNumberKey(event)"/>
                            </div>
                            <div class="col-xs-3 col-md-3">
                                <label>Fecha de Pago</label>
                                <input type="text" class="form-control" id="fecha_pago" />
                            </div>
                        </div>
                        <div class="row mt-5">
                            <div class="col-xs-3 col-md-3">
                                <label>Canal de Pago</label>
                                <select class="form-control select2" id="canal_pagoCom">
                                    <option selectd value="0">Selecciona</option>
                                    <option value="1">Sucursal</option>
                                    <option value="2">Pago referenciado</option>
                                    <option value="3">Banca Electrónica</option>
                                    <option value="4">Banca Practicajas</option>
                                    <option value="5">Banco</option>
                                </select>
                            </div>
                            <div class="col-xs-3 col-md-3">
                                <br />
                                <label>Manifiesto</label>
                                <input type="checkbox" id="manifiesto" name="manifiesto" value="1" class="minimal" checked>
                            </div>
                            <div class="col-xs-3 col-md-3">
                                <br />
                                <label>Accionista</label>
                                <input type="checkbox" id="accionista" name="accionista" value="1" class="minimal" checked>
                            </div>
                            <div class="col-xs-3 col-md-3">
                                <input type="hidden" id="tipo_documento" value="FPDC.AE-014.4" />
                            </div>
                        </div>
                        <div class="row mt-5">
                            <div class="col-xs-3 col-md-3" id="div_bancoCom" style="display:none">
                                <label>Banco</label>
                                <input type="text" id="bancoCom" class="form-control" >
                            </div>
                        </div>
                        <hr />
                        <div class="row mt-5">
                            <div class="col-xs-12 col-md-12 table-responsive">
                                <table id="table-datos" class="table table-bordered table-striped">
                                    <thead>
                                        <tr>
                                            <th>Cargo</th>
                                            <th>Nombres</th>
                                            <th>Tipo Transacción</th>
                                            <th>Monto estimado de operaciones realizadas al mes</th>
                                            <th>Número estimado de operaciones a realizar al mes </th>
                                            <th>Nivel de Riesgo de PLD </th>
                                            <th>Código del Cliente</th>
                                            <th>Ingreso Semanal</th>
                                            <th>Monto</th>
                                        </tr>
                                    </thead>
                                    <tbody id="bodyDetalles"></tbody>
                                </table>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-xs-2 col-md-2">
                                <label>SubTotal Monto Solicitado</label>
                                <input type="text" class="form-control" value="0" id="subtotal_solicitado" />
                            </div>
                            <div class="col-xs-2 col-md-2">
                                <label>SubTotal Monto Autorizado</label>
                                <input type="text" class="form-control" value="0" id="subtotal_autorizado" />
                            </div>
                            <div class="col-xs-2 col-md-2">
                                <label>Total Monto Solicitado</label>
                                <input type="text" class="form-control" value="0" id="total_solicitado" />
                            </div>
                            <div class="col-xs-2 col-md-2">
                                <label>Total Monto Autorizado</label>
                                <input type="text" class="form-control" value="0" id="total_autorizado" />
                            </div>
                            <div class="col-xs-4 col-md-4">
                                <label>Observaciones</label>
                                <textarea class="form-control" id="obs"></textarea>
                            </div>
                        </div>
                    </div>
                    <!-- /.box-body -->
                    <div class="box-footer">
                        <button class="btn btn-primary" onclick="addCreditoCom()"><i class="fa fa-save"></i> Agregar</button>
                    </div>

                </div>
                <!-- /.box -->
            </div>
            <!--/.col (left) -->
        </div>
        <!-- /.row -->
    </section>
    <!-- /.content -->
</div>
<!-- /.content-wrapper -->
<div class="modal fade" id="modal_saveG">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">Agregar Garantia</h4>
            </div>
            <div class="modal-body" style="text-align:center">
                <div class="row">
                    <div class="col-xs-6 col-md-12">
                        <label>Nombre del Cliente</label>
                        <select class="form-control select-2" id="nombre_cliente">
                            <option selected value="0">Selecciona</option>
                            <option value="1">Miranda Carvajal</option>
                            <option value="2">Angel Amigon</option>
                            <option value="3">Yahir Pereira</option>
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-12 col-md-12">
                        <p>¿El negocio está funcionando?</p>
                        <br />
                        <label>
                            Si <input type="radio" name="res1" class="minimal" value="1" checked>
                        </label>
                        <label>
                            No <input type="radio" name="res1" value="0" class="minimal">
                        </label>
                    </div>
                    <div class="col-xs-12 col-md-12">
                        <p>¿La información y foto (tomada por el asesor) coincide con el negocio que observa en la supervisión? </p>
                        <br />
                        <label>
                            Si <input type="radio" name="res2" class="minimal" value="1" checked>
                        </label>
                        <label>
                            No <input type="radio" name="res2" value="0" class="minimal">
                        </label>
                    </div>
                    <div class="col-xs-12 col-md-12">
                        <p>¿El cliente, conoce y avala a sus compañeros del grupo? o ¿El aval conoce y respalda al titular?</p>
                        <br />
                        <label>
                            Si <input type="radio" name="res7" class="minimal" value="1" checked>
                        </label>
                        <label>
                            No <input type="radio" name="res7" value="0" class="minimal">
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="btn_supervision">Aceptar</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
@section Scripts
{
    <script>
        $(document).ready(function () {
            $('.select2').select2();
            $('#importe_credito').maskMoney();
            $('#monto_grupal').maskMoney();
            $('#monto').maskMoney();
            //Flat red color scheme for iCheck
            $('input[type="checkbox"].flat-red, input[type="radio"].flat-red').iCheck({
                checkboxClass: 'icheckbox_flat-green',
                radioClass: 'iradio_flat-green'
            })
            $('input[type="checkbox"].minimal, input[type="radio"].minimal').iCheck({
                checkboxClass: 'icheckbox_minimal-blue',
                radioClass: 'iradio_minimal-blue'
            })
            $('.fca').datepicker({
                autoclose: true,
                dateFormat: 'dd/mm/yyyy',
                Default: "es"

            })
            $('#fecha_recibo').datepicker({
                autoclose: true,
                dateFormat: 'dd/mm/yyyy',
                Default: "es"

            })
            $('#fecha_pago').datepicker({
                autoclose: true,
                dateFormat: 'dd/mm/yyyy',
                Default: "es"

            })
            $("#fecha").keypress(function (event) { event.preventDefault(); });
            $("#fecha_recibo").keypress(function (event) { event.preventDefault(); });
            $("#fecha_pago").keypress(function (event) { event.preventDefault(); });
            $('.flat-red').on('ifChanged', function (event) {
                if (event.target.checked == true) {
                    if (event.target.value == 1) {
                        $("#div_clienteS").css('visibility', 'visible');
                        $("#div_grupoS").css('visibility', 'hidden');
                    } else {
                        $("#div_clienteS").css('visibility', 'hidden');
                        $("#div_grupoS").css('visibility', 'visible');
                    }

                }
            });
            consultaContenidoCheck();

            $("#canal_pagoCom").change(function () {
                var canal_pago = $('#canal_pagoCom option:selected').val() == undefined ? '0' : $('#canal_pagoCom option:selected').val();
                if (canal_pago == 5) {
                    $("#div_bancoCom").css('display', 'block');
                } else {
                    $("#div_bancoCom").css('display', 'none');
                }
            });

            var grupsCom = [];
            grupsCom.push({
                "cargo": "S",
                "nombres": "Carlos Huerta Jimenez",
                "tipo_transaccion": "OC",
                "monto_mes": "2500",
                "numero_mes": "3",
                "nivel_riesgo": "A",
                "codigo_cliente": "34DS2XC9",
                "ingreso_semanal": "5000",
                "monto": "1500"
            }, {
                "cargo": "S",
                "nombres": "Yurieli Hernandéz Cerón",
                "tipo_transaccion": "OC",
                "monto_mes": "500",
                "numero_mes": "5",
                "nivel_riesgo": "B",
                "codigo_cliente": "YHC90SH",
                "ingreso_semanal": "3000",
                "monto": "500"
            }, {
                "cargo": "C",
                "nombres": "Ivana Luna Coca",
                "tipo_transaccion": "PC",
                "monto_mes": "1500",
                "numero_mes": "2",
                "nivel_riesgo": "M",
                "codigo_cliente": "LC87HSGH",
                "ingreso_semanal": "7000",
                "monto": "3000"
            });
            $("#grupoCom").change(function () {

                console.log(grupsCom);
                $("#bodyDetalles").empty();
                var s = "";
                for (var r = 0; r < grupsCom.length; r++) {

                    s += '<tr><td>' + grupsCom[r].cargo + '</td><td>' + grupsCom[r].nombres + '</td><td>' + grupsCom[r].tipo_transaccion + '</td><td>' + grupsCom[r].monto_mes + '</td><td>' + grupsCom[r].numero_mes + '</td><td>' + grupsCom[r].nivel_riesgo + '</td><td>' + grupsCom[r].codigo_cliente + '</td><td>' + grupsCom[r].ingreso_semanal + '</td><td>' + grupsCom[r].monto + '</td></tr>';
                }
                $("#bodyDetalles").append(s);
            });

            $('#table-datos').DataTable({
                'paging': true,
                'lengthChange': false,
                'searching': false,
                'ordering': true,
                'info': true,
                'autoWidth': false,
                "language": {
                    "sProcessing": "Procesando...",
                    "sLengthMenu": "Mostrar _MENU_ registros",
                    "sZeroRecords": "No se encontraron resultados",
                    "sEmptyTable": "Ningún dato disponible en esta tabla",
                    "sInfo": "Registros del _START_ al _END_  total: _TOTAL_ ",
                    "sInfoEmpty": "Sin registros",
                    "sInfoFiltered": "(filtrado de un total de _MAX_ registros)",
                    "sInfoPostFix": "",
                    "sSearch": "Buscar:",
                    "sUrl": "",
                    "sInfoThousands": ",",
                    "sLoadingRecords": "Cargando...",
                    "oPaginate": {
                        "sFirst": "Primero",
                        "sLast": "Último",
                        "sNext": "Siguiente",
                        "sPrevious": "Anterior"
                    },
                    "oAria": {
                        "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
                        "sSortDescending": ": Activar para ordenar la columna de manera descendente"
                    }
                }
            });
        });

        function compruebaV() {
            var vc = $("#dia_pago").val();
            vc = parseInt(vc);
            console.log(vc);
            if (vc < 1 || vc > 31) {
                $.toast({
                    text: "Día de Pago no valido",
                    hideAfter: false
                })
                $("#dia_pago").val("");
                $("#dia_pago").focus();
            }
        }
    </script>
}


